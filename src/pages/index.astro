---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");
const latestPostData = await (async () => {
  const filtered = allPosts
    .filter((post) => !post.data.draft)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())[0];

  if (!filtered) return null;

  const { Content } = await filtered.render();
  return { post: filtered, Content };
})();

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  }).format(date);
};
---

<Layout>
  <div id="main">
    <h1>Fishstick Labs</h1>
    <p class="tagline">
      Twenty years building infrastructure. Still learning.
    </p>

    <section id="about">
      <p>
        I write about DevOps, SRE, and platform engineering. Sometimes I advise early-stage teams on infrastructure decisions and strategy.
      </p>
    </section>

    {
      latestPostData && (
        <section id="latest-post">
          <h2>Latest Writing</h2>
          <article>
            <a href={`/blog/${latestPostData.post.slug}`}>
              <h3>{latestPostData.post.data.title}</h3>
            </a>
            <div class="post-excerpt">
              <latestPostData.Content />
            </div>
            <div class="post-footer">
              <div class="post-meta">
                <span>{latestPostData.post.data.author}</span>
                <span class="separator">•</span>
                <time>{formatDate(latestPostData.post.data.pubDate)}</time>
              </div>
              <a href={`/blog/${latestPostData.post.slug}`} class="read-more">Read more →</a>
            </div>
          </article>
          <hr style="border: none; border-top: 1px solid rgba(255, 255, 255, 0.08); margin: 40px 0;" />
          <div>
            <a href="/blog">View all posts →</a>
          </div>
        </section>
      )
    }

    <section id="contact">
      <h2>Contact</h2>
      <p>Interested in talking? Email <a href="mailto:contact@fishsticklabs.com">contact@fishsticklabs.com</a></p>
      <p class="contact-details">
        Based in Oklahoma City<br/>
        LinkedIn: <a href="https://linkedin.com/in/doddschris">linkedin.com/in/doddschris</a>
      </p>
    </section>
    <footer>
      <p>&copy; 2025 - Fishstick Labs</p>
    </footer>
  </div>
</Layout>
